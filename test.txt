import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.session.jdbc.JdbcIndexedSessionRepository;
import org.springframework.session.jdbc.config.annotation.web.http.EnableJdbcHttpSession;
import org.springframework.session.jdbc.config.annotation.web.http.JdbcHttpSessionConfiguration;
import org.springframework.session.serializer.Jackson2JsonSerializer;
import javax.sql.DataSource;

@Configuration
@EnableJdbcHttpSession
public class SessionConfig {

    @Bean
    public JdbcIndexedSessionRepository sessionRepository(DataSource dataSource, ObjectMapper objectMapper) {
        JdbcIndexedSessionRepository sessionRepository = new JdbcIndexedSessionRepository(dataSource);
        
        // Use Jackson2JsonSerializer for the default serializer.
        Jackson2JsonSerializer<Object> serializer = new Jackson2JsonSerializer<>(Object.class);
        serializer.setObjectMapper(objectMapper);
        sessionRepository.setDefaultSerializer(serializer);
        
        // (Optional) Configure other settings as needed.
        return sessionRepository;
    }
}
